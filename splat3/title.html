<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <!-- Bootstrap CSS -->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
            integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N"
            crossorigin="anonymous"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
        />
        <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.0/dist/bootstrap-table.min.css" />
        <script
            src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"
            integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct"
            crossorigin="anonymous"
        ></script>
        <script src="https://unpkg.com/bootstrap-table@1.21.0/dist/bootstrap-table.min.js"></script>
        <script defer src="js/dist/json-formatter.umd.js" charset="UTF-8"></script>
        <title>Splatoon 3 - Title Database</title>
        <style>
            .bd-placeholder-img {
                font-size: 1.125rem;
                text-anchor: middle;
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }
            @media (min-width: 768px) {
                .bd-placeholder-img-lg {
                    font-size: 3.5rem;
                }
            }
            .themed-grid-col {
                padding-top: 15px;
                padding-bottom: 15px;
                background-color: rgba(86, 61, 124, 0.15);
                border: 1px solid rgba(86, 61, 124, 0.2);
            }
        </style>
    </head>
    <body>
        <nav class="navbar navbar-expand-md navbar-dark bg-dark">
            <a class="navbar-brand" href="#">Title Database</a>
            <button
                class="navbar-toggler"
                type="button"
                data-toggle="collapse"
                data-target="#navbarCollapse"
                aria-controls="navbarCollapse"
                aria-expanded="false"
                aria-label="Toggle navigation"
            >
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="database.html">Weapon and Gear Database</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="damagetable.html">Damage Multipliers</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="misc.html">Misc Database</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="manuals.html">Manual Database</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="parameters.html">Parameter Database</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="tableturf.html">Tableturf Battle Database</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="title.html">Title Database</a>
                    </li>
                </ul>
            </div>
        </nav>
        <main role="main">
            <div class="jumbotron">
                <div class="col-sm-8 mx-auto">
                    <h1>Splatoon 3 - Title Database</h1>
                    <div class="toolbar">
                        <select class="form-control" id="language"></select>
                        <select class="form-control" id="version"></select>
                    </div>
                    <ul class="nav nav-tabs" id="modes" role="tablist">
                        <li class="nav-item">
                            <a
                                class="nav-link active"
                                id="titles-tab"
                                data-toggle="tab"
                                href="#titles"
                                role="tab"
                                aria-controls="titles"
                                aria-selected="true"
                                >Titles</a
                            >
                        </li>
                    </ul>
                    <div class="tab-content" id="modeTabControl">
                        <h2>Adjectives</h2>
                        <div class="tab-pane fade show active" id="titles" role="tabpanel" aria-labelledby="titles-tab">
                            <div class="table-responsive">
                                <table
                                    class="table table-striped table-hover"
                                    id="titles-adj-table"
                                    data-sortable="true"
                                    data-search="true"
                                    data-show-columns="true"
                                    data-show-pagination-switch="true"
                                    data-show-fullscreen="true"
                                >
                                    <thead>
                                        <tr>
                                            <th scope="col" data-field="Id" data-sortable="true" data-visible="false">
                                                Internal ID
                                            </th>
                                            <th scope="col" data-field="Id" data-formatter="nameFormatter">Name</th>
                                            <th scope="col" data-field="HowToGet">How To Get</th>
                                            <th scope="col" data-field="Season">Season</th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                            <h2>Subjects</h2>
                            <div class="table-responsive">
                                <table
                                    class="table table-striped table-hover"
                                    id="titles-sub-table"
                                    data-sortable="true"
                                    data-search="true"
                                    data-show-columns="true"
                                    data-show-pagination-switch="true"
                                    data-show-fullscreen="true"
                                >
                                    <thead>
                                        <tr>
                                            <th scope="col" data-field="Id" data-sortable="true" data-visible="false">
                                                Internal ID
                                            </th>
                                            <th scope="col" data-field="Id" data-formatter="nameFormatter2">Name</th>
                                            <th scope="col" data-field="HowToGet">How To Get</th>
                                            <th scope="col" data-field="Season">Season</th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <script>
            const prefix = "https://leanny.github.io/splat3/"
            //const prefix = "http://127.0.0.1:5500/"
            let version = 100

            let lang_dict = {}

            const localize = (dir, key) => lang_dict[dir][key]

            function nameFormatter(value) {
                return localize("CommonMsg/Byname/BynameAdjective", value)
            }

            function nameFormatter2(value) {
                return localize("CommonMsg/Byname/BynameSubject", value)
            }

            var mpuFormatter = value => value[1]

            const languages = [
                {
                    ext: "USen",
                    region: "NA",
                    language: "en",
                    name: "English",
                },
                {
                    ext: "EUen",
                    region: "EU",
                    language: "en",
                    name: "English (UK)",
                },
                {
                    ext: "EUes",
                    region: "EU",
                    language: "es",
                    name: "Español",
                },
                {
                    ext: "USes",
                    region: "NA",
                    language: "es-MX",
                    name: "Español (MX)",
                },
                {
                    ext: "EUfr",
                    region: "EU",
                    language: "fr",
                    name: "Français",
                },
                {
                    ext: "USfr",
                    region: "NA",
                    language: "fr-CA",
                    name: "Français (CA)",
                },
                {
                    ext: "EUde",
                    region: "EU",
                    language: "de",
                    name: "Deutsch",
                },
                {
                    ext: "EUnl",
                    region: "EU",
                    language: "nl",
                    name: "Nederlands",
                },
                {
                    ext: "EUit",
                    region: "EU",
                    language: "it",
                    name: "Italiano",
                },
                {
                    ext: "EUru",
                    region: "EU",
                    language: "ru",
                    name: "Pусский",
                },
                {
                    ext: "JPja",
                    region: "JP",
                    language: "ja",
                    name: "日本語",
                },
                {
                    ext: "CNzh",
                    region: "AP",
                    language: "cn",
                    name: "中文（简体）",
                },
                {
                    ext: "KRko",
                    region: "AP",
                    language: "kr",
                    name: "한국어",
                },
                {
                    ext: "TWzh",
                    region: "AP",
                    language: "tw",
                    name: "中文（繁體）",
                },
            ]

            for (const lang of Object.values(languages)) {
                $("#language").append(new Option(lang["name"], lang["ext"]))
            }

            function detectSplatoonLanguage() {
                let browserLanguages = window.navigator.languages.map(l => l.toLowerCase())
                let availableLanguages = languages.map(l => l.language.toLowerCase())
                let resultLanguages = {}
                for (const lang of Object.values(languages)) {
                    resultLanguages[lang["language"]] = lang["ext"]
                }

                // Try to find a match based on the first part of the available languages (i.e., match "es" for "es-ES")
                for (let language of browserLanguages) {
                    for (let availableLanguage of availableLanguages) {
                        if (language.startsWith(availableLanguage)) {
                            return resultLanguages[availableLanguage]
                        }
                    }
                }
            }

            $.getJSON(prefix + "versions.json", vers => {
                let last = 0
                vers.forEach(ver => {
                    if (ver === "099") {
                        $("#version").append(new Option("Testfire", ver))
                    } else {
                        $("#version").append(new Option(ver[0] + "." + ver[1] + "." + ver[2], ver))
                    }
                    last = ver
                })
                $("#version").val(last)
                version = last
            })

            function loadData() {
                $.getJSON(prefix + "data/mush/" + version + "/BynameAdjectiveInfo.json", data_dict => {
                    all_titles = {}
                    data_dict.forEach(entry => {
                        all_titles[entry.Id] = entry
                    })
                    $.getJSON(
                        prefix + "data/parameter/" + version + "/byname/Adjective_" + current_lang + ".json",
                        new_data_dict => {
                            all_labels = []
                            new_data_dict.Labels.forEach(element => {
                                if (getNum(element) in all_titles) {
                                    const e = all_titles[getNum(element)]
                                    row = {
                                        Id: element,
                                        HowToGet: e.HowToGet,
                                        Season: e.Season,
                                    }
                                    all_labels.push(row)
                                }
                            })
                            $("#titles-adj-table").bootstrapTable("refreshOptions", {
                                data: all_labels,
                            })
                        }
                    )
                })
                $.getJSON(prefix + "data/mush/" + version + "/BynameSubjectInfo.json", data_dict => {
                    all_subs = {}
                    data_dict.forEach(entry => {
                        all_subs[entry.Id] = entry
                    })
                    $.getJSON(
                        prefix + "data/parameter/" + version + "/byname/Subject_" + current_lang + ".json",
                        subject_dict => {
                            all_labels = []
                            subject_dict.Labels.forEach(element => {
                                if (getNum2(element) in all_subs) {
                                    const e = all_subs[getNum2(element)]
                                    row = {
                                        Id: element,
                                        HowToGet: e.HowToGet,
                                        Season: e.Season,
                                    }
                                    all_labels.push(row)
                                }
                            })
                            $("#titles-sub-table").bootstrapTable("refreshOptions", {
                                data: all_labels,
                            })
                        }
                    )
                })
            }

            let current_lang = detectSplatoonLanguage()
            if (typeof current_lang === "undefined") {
                current_lang = "EUen"
            }

            window.change_lang = lang => {
                current_lang = lang
                $.getJSON(prefix + "data/language/" + current_lang + ".json", d => {
                    for (const [key, value] of Object.entries(d)) {
                        lang_dict[key] = value
                    }
                    translate_menu()
                    loadData()
                })
            }

            change_lang(current_lang)

            const capitalizeFirstLetter = string => string.charAt(0).toUpperCase() + string.slice(1)

            const getNum = string => Number(string)
            const getNum2 = string => getNum(string.slice(0, -2))

            function translate_menu() {
                $("#titles-tab").text(capitalizeFirstLetter(localize("CommonMsg/Glossary", "Byname")))
                //$("#weapons-tab").text(localize("LayoutMsg/Cmn_CstBase_00", "L_BtnCategory_00-T_Category_00"))
                //$("#heads-tab").text(localize("LayoutMsg/Cmn_CstBase_00", "L_BtnCategory_01-T_Category_00"))
                //$("#clothes-tab").text(localize("LayoutMsg/Cmn_CstBase_00", "L_BtnCategory_02-T_Category_00"))
                //$("#shoes-tab").text(localize("LayoutMsg/Cmn_CstBase_00", "L_BtnCategory_03-T_Category_00"))
                //
            }

            $(function () {
                $("#titles-sub-table").bootstrapTable({})
                $("#titles-adj-table").bootstrapTable({})
                $("#language").val(current_lang)
                $("#language").change(function () {
                    change_lang($(this).val())
                })
                $("#version").change(() => {
                    version = $(this).val()
                    loadData()
                })
            })
        </script>
        <footer class="footer">
            <div class="container text-muted">
                <div class="footer-notice">
                    <p>Webpage created by Lean. Framework used is <a href="https://getbootstrap.com/">Bootstrap</a>.</p>
                    <p>
                        Feedback or suggestions are welcome. Please contact me via Twitter.
                        <a href="https://twitter.com/LeanYoshi"><span class="fa fa-twitter"></span></a>
                    </p>
                </div>
            </div>
        </footer>
    </body>
</html>
