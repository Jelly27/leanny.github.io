<!doctype html>
<html lang="en">
   <head>
      <!-- Required meta tags -->
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <!-- Bootstrap CSS -->
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
      <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.0/dist/bootstrap-table.min.css">
      <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
      <script src="https://unpkg.com/bootstrap-table@1.21.0/dist/bootstrap-table.min.js"></script>
      <title>Splatoon 3 - Weapon and Gear Database</title>
      <style>
         .bd-placeholder-img {
         font-size: 1.125rem;
         text-anchor: middle;
         -webkit-user-select: none;
         -moz-user-select: none;
         -ms-user-select: none;
         user-select: none;
         }
         @media (min-width: 768px) {
         .bd-placeholder-img-lg {
         font-size: 3.5rem;
         }
         }
         .themed-grid-col {
         padding-top: 15px;
         padding-bottom: 15px;
         background-color: rgba(86, 61, 124, .15);
         border: 1px solid rgba(86, 61, 124, .2);
         }
      </style>
   </head>
   <body>
      <nav class="navbar navbar-expand-md navbar-dark bg-dark">
         <a class="navbar-brand" href="#">Weapon and Gear Database</a>
         <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
         <span class="navbar-toggler-icon"></span>
         </button>
         <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav mr-auto">
               <li class="nav-item">
                  <a class="nav-link" href="index.html">Home</a>
               </li>
               <li class="nav-item">
                  <a class="nav-link" href="database.html">Weapon and Gear Database</a>
               </li>
               <!--<li class="nav-item">
                  <a class="nav-link" href="damagetable.html">Damage Multipliers</a>
               </li>
               
               <li class="nav-item">
                  <a class="nav-link" href="parameters.html">Parameter Database</a>
               </li>
               <li class="nav-item">
                  <a class="nav-link" href="parameter_calcs.html">Parameter Calculator</a>
               </li>-->
            </ul>
         </div>
      </nav>
      <main role="main">
         <div class="jumbotron">
            <div class="col-sm-8 mx-auto">
               <h1>Splatoon 3 - Weapon and Gear Database</h1>
               <div class="toolbar">
                  <select class="form-control" id="language">
                  </select>
                  <select class="form-control" id="version">
                  </select>
               </div>
               <ul class="nav nav-tabs" id="modes" role="tablist">
                  <li class="nav-item">
                     <a class="nav-link active" id="weapons-tab" data-toggle="tab" href="#weapons" role="tab" aria-controls="weapons" aria-selected="true">General Weapon Info</a>
                  </li>
                  <li class="nav-item">
                     <a class="nav-link" id="heads-tab" data-toggle="tab" href="#heads" role="tab" aria-controls="heads" aria-selected="false">Heads</a>
                  </li>
                  <li class="nav-item">
                     <a class="nav-link" id="clothes-tab" data-toggle="tab" href="#clothes" role="tab" aria-controls="clothes" aria-selected="false">Clothes</a>
                  </li>
                  <li class="nav-item">
                     <a class="nav-link" id="shoes-tab" data-toggle="tab" href="#shoes" role="tab" aria-controls="shoes" aria-selected="false">Shoes</a>
                  </li>
               </ul>
               <div class="tab-content" id="modeTabControl">
                  <div class="tab-pane fade show active" id="weapons" role="tabpanel" aria-labelledby="weapons-tab">
                     <div class="table-responsive">
                        <table class="table table-striped table-hover" id="weapon-table" data-sortable="true" data-search="true" data-show-columns="true" data-show-pagination-switch="true" data-show-fullscreen="true">
                           <thead>
                              <tr>
                                 <th scope="col" data-field="Id" data-sortable="true" data-visible="false">Internal ID</th>
                                 <th scope="col" data-field="NameClean" data-formatter="imgFormatter" data-sortable="false">Image</th>
                                 <th scope="col" data-field="InternalName" data-sortable="true" data-visible="false">Internal Name</th>
                                 <th scope="col" data-field="Name" data-sortable="true">Name</th>
                                 <th scope="col" data-field="Sub" data-formatter="subFormatter" data-sortable="true">Sub</th>
                                 <th scope="col" data-field="Special" data-formatter="specialFormatter" data-sortable="true">Special</th>
                                 <th scope="col" data-field="RewardLvl0" data-formatter="badge00Formatter" data-sortable="true">Badge Lvl 0</th>
                                 <th scope="col" data-field="RewardLvl1" data-formatter="badge01Formatter" data-sortable="true">Badge Lvl 1</th>          
                                 <th scope="col" data-field="Range" data-sortable="true">Matchmaking Range</th>
                                 <th scope="col" data-field="Season" data-sortable="true">Season</th>
                                 <th scope="col" data-field="ShopPrice" data-sortable="true">Shop Price</th>
                                 <th scope="col" data-field="ShopUnlockRank" data-sortable="true">Unlock Level</th>
                                 <th scope="col" data-field="SpecialPoint" data-sortable="true">Special Points</th>
                                 <th scope="col" data-field="UIParam" data-formatter="UIParamFormatter" data-sortable="false">Parameters</th>
                              </tr>
                           </thead>
                        </table>
                     </div>
                  </div>
                  <div class="tab-pane fade" id="subweapons" role="tabpanel" aria-labelledby="subweapon-tab">
                     <div class="table-responsive">
                        <table class="table table-striped table-hover" id="subweapon-table" data-sortable="true" data-search="true" data-show-columns="true" data-show-pagination-switch="true" data-show-fullscreen="true">
                           <thead>
                              <tr>
                                 <th scope="col" data-field="Id" data-sortable="true" data-visible="false">Internal ID</th>
                                 <th scope="col" data-field="NameClean" data-formatter="subimgFormatter" data-sortable="false">Image</th>
                                 <th scope="col" data-field="Name" data-sortable="true">Name</th>
                                 <th scope="col" data-field="InkSaverType" data-sortable="true">Ink Saver Type</th>
                              </tr>
                           </thead>
                        </table>
                     </div>
                  </div>
                  <div class="tab-pane fade" id="heads" role="tabpanel" aria-labelledby="heads-tab">
                     <div class="table-responsive">
                        <table class="table table-striped table-hover" id="heads-table" data-sortable="true" data-search="true" data-show-columns="true" data-show-pagination-switch="true" data-show-fullscreen="true">
                           <thead>
                              <tr>
                                 <th scope="col" data-field="Id" data-sortable="true" data-visible="false">Internal ID</th>
                                 <th scope="col" data-field="NameClean" data-formatter="gearimgFormatter" data-sortable="false">Image</th>
                                 <th scope="col" data-field="Name" data-sortable="true">Name</th>
                                 <th scope="col" data-field="Brand" data-formatter="brandFormatter" data-sortable="true">Brand</th>
                                 <th scope="col" data-field="Skill0" data-formatter="skillFormatter" data-sortable="true">Main Ability</th>
                                 <th scope="col" data-field="Price" data-sortable="true">Price</th>
                                 <th scope="col" data-field="Rarity" data-sortable="true">Rarity</th>
                              </tr>
                           </thead>
                        </table>
                     </div>
                  </div>
                  <div class="tab-pane fade" id="clothes" role="tabpanel" aria-labelledby="clothes-tab">
                     <div class="table-responsive">
                        <table class="table table-striped table-hover" id="clothes-table" data-sortable="true" data-search="true" data-show-columns="true" data-show-pagination-switch="true" data-show-fullscreen="true">
                           <thead>
                              <tr>
                                 <th scope="col" data-field="Id" data-sortable="true" data-visible="false">Internal ID</th>
                                 <th scope="col" data-field="NameClean" data-formatter="gearimgFormatter" data-sortable="false">Image</th>
                                 <th scope="col" data-field="Name" data-sortable="true">Name</th>
                                 <th scope="col" data-field="Brand" data-formatter="brandFormatter" data-sortable="true">Brand</th>
                                 <th scope="col" data-field="Skill0" data-formatter="skillFormatter" data-sortable="true">Main Ability</th>
                                 <th scope="col" data-field="Price" data-sortable="true">Price</th>
                                 <th scope="col" data-field="Rarity" data-sortable="true">Rarity</th>
                              </tr>
                           </thead>
                        </table>
                     </div>
                  </div>
                  <div class="tab-pane fade" id="shoes" role="tabpanel" aria-labelledby="shoes-tab">
                     <div class="table-responsive">
                        <table class="table table-striped table-hover" id="shoes-table" data-sortable="true" data-search="true" data-show-columns="true" data-show-pagination-switch="true" data-show-fullscreen="true">
                           <thead>
                              <tr>
                                 <th scope="col" data-field="Id" data-sortable="true" data-visible="false">Internal ID</th>
                                 <th scope="col" data-field="NameClean" data-formatter="gearimgFormatter" data-sortable="false">Image</th>
                                 <th scope="col" data-field="Name" data-sortable="true">Name</th>
                                 <th scope="col" data-field="Brand" data-formatter="brandFormatter" data-sortable="true">Brand</th>
                                 <th scope="col" data-field="Skill0" data-formatter="skillFormatter" data-sortable="true">Main Ability</th>
                                 <th scope="col" data-field="Price" data-sortable="true">Price</th>
                                 <th scope="col" data-field="Rarity" data-sortable="true">Rarity</th>
                              </tr>
                           </thead>
                        </table>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </main>
      <script>
        const prefix = "https://leanny.github.io/splat3/"
        //const prefix = "http://127.0.0.1:5500/"
        let version = 100
        
        let lang_dict = {}
        let weapon_data = {}
        let subweapon_data = {}
        let hed_gear = {}
        let clt_gear = {}
        let shs_gear = {}
        
        const format_img = (base_url, value, width) => `<img src="${base_url}${value}.png" width="${width}" />`
    
        //var imgFormatter = value => format_img(prefix + "images/weapon/Wst_", value, 96)
        var imgFormatter = value => format_img(prefix + "images/weapon_flat/Path_Wst_", value, 96)

        var gearimgFormatter = value => format_img(prefix + "images/gear/", value, 96)
        
        var skillFormatter = value => {
            const tmp = format_img(prefix + "images/skill/", value, 96)
            return `<p>${tmp}<br />${lang_dict[value]}</p>`
        }
        
        var brandFormatter = value => {
            const tmp = format_img(prefix + "images/brand/", value, 64)
            return `<p>${tmp}<br />${lang_dict[value]}</p>`
        }
        
        var subimgFormatter = value => format_img(prefix + "images/subspe/Wsb_", value, 64)
        
        var subFormatter = value => {
            const tmp = format_img(prefix + "images/subspe/Wsb_", value[0] + "00", 64)
            return `<p>${tmp}<br />${value[1]}</p>`
        }
        
        var specialFormatter = value => {
            const tmp = format_img(prefix + "images/subspe/Wsp_", value[0] + "00", 64)
            return `<p>${tmp}<br />${value[1]}</p>`
        }
        
        var badge00Formatter = value => format_img(prefix + "images/badge/Badge_WeaponLevel_", value + "_Lv00", 96)
        var badge01Formatter = value => format_img(prefix + "images/badge/Badge_WeaponLevel_", value + "_Lv01", 96)

        var UIParamFormatter = value => {
            console.log(value)
            return `<b>${lang_dict[value[0]["Type"]]}: </b> ${value[0]["Value"]}<br /><b>${lang_dict[value[1]["Type"]]}: </b> ${value[1]["Value"]}<br /><b>${lang_dict[value[2]["Type"]]}: </b> ${value[2]["Value"]}<br />`
        }

        var mpuFormatter = value => value[1];
        
        const languages = [{
            ext: 'USen',
            region: 'NA',
            language: 'en',
            name: 'English'
        }, {
            ext: 'EUen',
            region: 'EU',
            language: 'en',
            name: 'English (UK)'
        }, {
            ext: 'EUes',
            region: 'EU',
            language: 'es',
            name: 'Español'
        }, {
            ext: 'USes',
            region: 'NA',
            language: 'es-MX',
            name: 'Español (MX)'
        }, {
            ext: 'EUfr',
            region: 'EU',
            language: 'fr',
            name: 'Français'
        }, {
            ext: 'USfr',
            region: 'NA',
            language: 'fr-CA',
            name: 'Français (CA)'
        }, {
            ext: 'EUde',
            region: 'EU',
            language: 'de',
            name: 'Deutsch'
        }, {
            ext: 'EUnl',
            region: 'EU',
            language: 'nl',
            name: 'Nederlands'
        }, {
            ext: 'EUit',
            region: 'EU',
            language: 'it',
            name: 'Italiano'
        }, {
            ext: 'EUru',
            region: 'EU',
            language: 'ru',
            name: 'Pусский'
        }, {
            ext: 'JPja',
            region: 'JP',
            language: 'ja',
            name: '日本語'
        }, ];
        
        for (const lang of Object.values(languages)) {
            $("#language").append(new Option(lang["name"], lang["ext"]))
        }
        
        function detectSplatoonLanguage() {
            let browserLanguages = window.navigator.languages.map(l => l.toLowerCase())
            let availableLanguages = languages.map(l => l.language.toLowerCase())
            let resultLanguages = {}
            for (const lang of Object.values(languages)) {
                resultLanguages[lang["language"]] = lang["ext"]
            }
        
            // Try to find a match based on the first part of the available languages (i.e., match "es" for "es-ES")
            for (let language of browserLanguages) {
                for (let availableLanguage of availableLanguages) {
                    if (language.startsWith(availableLanguage)) {
                        return resultLanguages[availableLanguage]
                    }
                }
            }
        }
        
        $.getJSON(prefix + "versions.json", vers => {
            let last = 0
            vers.forEach(ver => {
                $("#version").append(new Option(ver[0] + "." + ver[1] + "." + ver[2], ver))
                last = ver
            })
            $("#version").val(last)
            version = last
            loadData()
        })
        
        function loadData() {
            $.getJSON(prefix + "data/mush/" + version + "/WeaponInfoMain.json", weapon_dict => {
                weapon_data = {}
                subweapon_data = {}
                hed_gear = {}
                clt_gear = {}
                shs_gear = {}
                
                weapon_dict.forEach(item => {
                    //if (item["Id"] < 20000) {
                        weapon_data[item["Id"]] = item
                    //}
                })

                $.getJSON(prefix + "data/mush/" + version + "/WeaponInfoSub.json", subweapon_dict => {
                    subweapon_dict.forEach(item => {
                        //if (item["Id"] < 100) {
                            subweapon_data[item["Id"]] = item
                        //}
                    })
                    $.getJSON(prefix + "data/mush/" + version + "/GearInfoHead.json", hed_dict => {
                        hed_dict.forEach(item => {
                            hed_gear[item["Id"]] = item
                        })
                        $.getJSON(prefix + "data/mush/" + version + "/GearInfoClothes.json", clt_dict => {
                            clt_dict.forEach(item => {
                                clt_gear[item["Id"]] = item
                            })
                            $.getJSON(prefix + "data/mush/" + version + "/GearInfoShoes.json", shs_dict => {
                                shs_dict.forEach(item => {
                                    shs_gear[item["Id"]] = item
                                })
                                change_lang(current_lang)
                            })
                        })
                    })
                })
            })
        }
        
        let current_lang = detectSplatoonLanguage()
        if (typeof current_lang === "undefined") {
            current_lang = "EUen"
        }
        window.change_lang = lang => {
            current_lang = lang
            $.getJSON(prefix + "data/language/" + current_lang + ".json", d => {
                for (const [key, value] of Object.entries(d)) {
                    lang_dict[key] = value
                }
                load_weapons()
                load_subweapons()
                load_gear()
            })
        
        }
        function detailFormatterWeapon(index, row) {
            let html = []
            weapon = weapon_data[row["Id"]]
            html.push('<p><b>Name:</b> ' + row["Name"] + '</p>')
            html.push('<p><b>Sub:</b> ' + row["Sub"][1] + '</p>')
            html.push('<p><b>Special:</b> ' + row["Special"][1] + '</p>')
            html.push('<p><b>' + lang_dict[weapon["Param0"]] + ':</b> ' + weapon["ParamValue0"] + '</p>')
            html.push('<p><b>' + lang_dict[weapon["Param1"]] + ':</b> ' + weapon["ParamValue1"] + '</p>')
            html.push('<p><b>' + lang_dict[weapon["Param2"]] + ':</b> ' + weapon["ParamValue2"] + '</p>')
            html.push('<p><b>Inksaver Level:</b> ' + weapon["InkSaverLv"] + '</p>')
            html.push('<p><b>Mobility Class:</b> ' + weapon["MoveVelLv"] + '</p>')
            html.push('<p><b>Stealth Acceleration:</b> ' + weapon["StealthMoveAccLv"] + '</p>')
            if ("MainUpGearPowerType" in weapon) {
                html.push('<p><b>Main Power Up Effect:</b> ' + lang_dict["MPU_" + weapon["MainUpGearPowerType"]] + '</p>')
            }
            if ("ShotMoveVelType" in weapon) {
                html.push('<p><b>Shoot Move Velocity Type:</b> ' + weapon["ShotMoveVelType"] + '</p>')
            }
            if ("Range" in weapon) {
                html.push('<p><b>Matchmaking Range:</b> ' + weapon["Range"] + '</p>')
            }
            return html.join('')
        
        }
        
        const get_name = val => val.split(".")[0].substring(10)

        function load_weapons() {
            const data = []
            for (const weapon of Object.values(weapon_data)) {
                if (weapon["Id"] < 20000) {
                    const row = ({
                        Id: weapon["Id"],
                        NameClean: weapon["__RowId"],
                        InternalName: weapon["__RowId"],
                        Name: lang_dict[weapon["__RowId"]],
                        Sub: [get_name(weapon["SubWeapon"]), lang_dict[get_name(weapon["SubWeapon"])]],
                        Special: [get_name(weapon["SpecialWeapon"]), lang_dict[get_name(weapon["SpecialWeapon"])]],
                        SpecialPoint: weapon["SpecialPoint"],
                        Range: weapon["Range"],
                        RewardLvl0: weapon["__RowId"],
                        RewardLvl1: weapon["__RowId"],
                        Season: weapon["Season"],
                        ShopPrice: weapon["ShopPrice"],
                        ShopUnlockRank: weapon["ShopUnlockRank"],
                        UIParam: weapon["UIParam"]
                    })
                    data.push(row)
                }
            }
            $('#weapon-table').bootstrapTable('refreshOptions', {
                "data": data
            })
        }
        
        function load_subweapons() {
            const subdata = []
            for(const subweapon in Object.values(subweapon_data)) {
                if (subweapon["Id"] < 100) {
                    const row = ({
                        Id: subweapon["Id"],
                        NameClean: subweapon["__RowId"],
                        Name: lang_dict[subweapon["__RowId"]],
                    })
                    subdata.push(row)
                }
            }
            $('#subweapon-table').bootstrapTable('refreshOptions',{"data": subdata})
        }
        
        function load_gear_into_table(ref_table, ref_dict) {
            const geardata = []
            for(const gear of Object.values(ref_dict)) {
                const gearname = gear["__RowId"].substring(4)
                if (gearname in lang_dict) {
                    const row = ({
                        Id: gear["Id"],
                        NameClean: gear["__RowId"],
                        Name: lang_dict[gearname],
                        Brand: gear["Brand"],
                        Price: gear["Price"],
                        Rarity: gear["Rarity"] + 1,
                        Skill0: gear["Skill"]
                    })
                    geardata.push(row)
                }
            }
            $(ref_table).bootstrapTable('refreshOptions',{"data": geardata})
        }
        
        function load_gear() {
            load_gear_into_table('#heads-table', hed_gear)
            load_gear_into_table('#clothes-table', clt_gear)
            load_gear_into_table('#shoes-table', shs_gear)
        }
        
        $(function() {
            $('#weapon-table').bootstrapTable({})
            $('#subweapon-table').bootstrapTable({})
            $('#heads-table').bootstrapTable({})
            $('#clothes-table').bootstrapTable({})
            $('#shoes-table').bootstrapTable({})
            $("#language").val(current_lang)
            $('#language').change(function() {
                change_lang($(this).val())
            })
            $('#version').change(() => {
                version = ($(this).val())
                loadData()
            })
        })
     </script>
      <footer class="footer">
         <div class="container text-muted">
            <div class="footer-notice">
               <p>Webpage created by Lean. Framework used is <a href="https://getbootstrap.com/">Bootstrap</a>.</p>
               <p>Feedback or suggestions are welcome. Please contact me via Twitter. <a href="https://twitter.com/LeanYoshi"><span class="fa fa-twitter"></span></a></p>
            </div>
         </div>
      </footer>
   </body>
</html>
